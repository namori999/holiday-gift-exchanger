# プレゼント交換アプリ - 要件定義書

## 📋 プロジェクト概要

ホリデーシーズンのプレゼント交換をより楽しく、意味のあるものにするWebアプリケーション。
従来のビンゴやあみだくじの問題点を解決し、プレゼントの想いをしっかり伝えられる体験を提供します。

## 🎯 解決する課題

### 従来のプレゼント交換の問題点
1. **ビンゴの課題**: 時間がかかりすぎる
2. **あみだくじの課題**: 自分のプレゼントが自分に当たってしまう可能性がある
3. **コミュニケーションの課題**: プレゼントの説明や選んだ理由を伝える時間が十分にもらえない
4. **想いの共有**: おすすめの使い方などを詳しく説明できない

### 本アプリケーションの解決策
- スムーズな交換プロセス（MC主導）
- 確実に他の人にプレゼントが渡る仕組み
- 各プレゼントの詳細情報を画面で共有
- 後から振り返られる記録機能
- SNSシェア機能で思い出を共有

## 👥 ユーザーロール

### MC（マスター・オブ・セレモニー）
- 会の進行役
- 各パートの開始/次へ進む操作を行う
- **1イベントにつき1人のみ**

### 参加者
- プレゼント情報の入力
- プレゼントの受け取り
- 情報の閲覧と共有

## 🎨 主要機能

### 1. 記入パート

#### 1.1 参加者登録
- **必須項目**:
  - 名前（テキスト入力）
  - 進行役指定（チェックボックス）※1人のみ選択可能

#### 1.2 プレゼント情報入力
- **必須項目**:
  - プレゼントのタイトル（テキスト）
  - 選んだ理由（テキストエリア）

- **任意項目**:
  - プレゼント画像（画像アップロード）
  - おすすめの使い方（テキストエリア）

#### 1.3 記入状態の管理
- 全参加者の記入完了状態を表示
- 全員が記入完了したらMCに「交換スタート」ボタンを表示

### 2. 交換パート

#### 2.1 プレゼント配布アルゴリズム
- **制約条件**: 自分のプレゼントが自分に当たらないようにする
- ランダムな組み合わせを生成
- アルゴリズム: 完全順列（derangement）を使用

#### 2.2 プレゼント発表演出
1. **アニメーション**: サンタクロースが登場
2. **メッセージ表示**:
   ```
   「{入力した名前}、君にはこのプレゼントをあげよう。メリークリスマス！」
   ```
3. **受け取り者の表示**: 名前を強調表示
4. **プレゼント情報の表示**:
   - プレゼントのタイトル
   - 画像（ある場合）
   - 選んだ理由
   - おすすめの使い方（ある場合）
   - 贈り主の名前

#### 2.3 進行制御
- 進行役専用「次へ」ボタン
- 参加者は閲覧のみ
- プレゼントの実物受け渡し時間を確保
- 全員分繰り返す

### 3. 終了後パート

#### 3.1 結果一覧表示
- **表示単位**: 受け取った人ごと
- **表示項目**（1項目あたり）:
  1. 受け取った人の名前
  2. プレゼントのタイトル
  3. プレゼント画像（ある場合）
  4. 選んだ理由
  5. おすすめの使い方（ある場合）
  6. 贈り主の名前

#### 3.2 画像生成・保存機能
- 各プレゼント情報を1枚の画像にまとめる
- 画像形式: PNG
- 保存方法: ダウンロード

#### 3.3 SNSシェア機能
- **シェア内容の種類**:
  1. もらったプレゼント
  2. あげたプレゼント
  3. イケてると思ったプレゼント

- **対応SNS**:
  - Twitter (X)
  - Instagram（画像保存経由）

## 🔄 ユーザーフロー

### MCフロー
```
[1. MC登録]
    ↓
[2. MC待機画面]
   - QRコード表示・共有
   - 参加者リストの確認
   - （任意）自分もプレゼント入力
    ↓
[3. プレゼント情報入力]（任意）
    ↓
[4. プレゼント交換を開始]
    ↓
[5. 開始アニメーション]
   - サンタ登場演出
    ↓
[6. プレゼント配布]
   - 1人ずつ発表
   - 「{名前}、君にはこのプレゼントをあげよう！」
    ↓
[7. プレゼント詳細表示]
   - 実物受け渡し時間
   - MC: 次のプレゼントボタン
    ↓
[8. 6-7を全員分繰り返し]
    ↓
[9. 結果一覧表示]
   - 全プレゼントのリスト
   - 詳細モーダルで確認
    ↓
[終了]
```

### 参加者フロー
```
[1. 参加者登録]
   - QRコードからルーム参加
   - ニックネーム入力
    ↓
[2. プレゼント情報入力]
   - タイトル（必須）
   - 選んだポイント（任意）
   - おすすめの使い方（任意）
    ↓
[3. 参加者待機画面]
   - MCがスタートするまで待機
    ↓
[4. 開始アニメーション]
   - サンタ登場演出
    ↓
[5. プレゼント配布]
   - 1人ずつ発表を閲覧
    ↓
[6. プレゼント詳細表示]
   - 詳細情報の閲覧
    ↓
[7. 5-6を全員分繰り返し]
    ↓
[8. 終了アニメーション]
    ↓
[9. 結果一覧表示]
   - 全プレゼントのリスト
   - 詳細モーダルで確認
    ↓
[終了]
```

## 📱 画面仕様

### 画面1: MC登録画面（MCRegistrationScreen）
- ロゴエリア（200px高さ）
- 「MCのニックネームを入力してください」
- ニックネーム入力フィールド（中央揃え、角丸）
- 「ルームを作る」ボタン（画面下部固定）

### 画面2: MC待機画面（MCWaitingScreen）
- ロゴ（左上、小サイズ）
- 「メンバーにQRコードを共有してください」
- QRコード表示エリア
- 「QRコードをダウンロード」ボタン
- 「自分もプレゼントを入力する」ボタン
- 参加中のメンバーリスト（入力済み/未入力ステータス付き）
- 「プレゼント交換を始める」ボタン（画面下部固定）

### 画面3: 参加者登録画面（ParticipantJoinScreen）
- ロゴエリア（200px高さ）
- 「ニックネームを入力」
- ニックネーム入力フィールド（中央揃え、角丸）
- 「ルームに参加」ボタン（画面下部固定、入力時のみ有効化）

### 画面4: プレゼント情報入力画面（PresentInputScreen）
- ロゴ（左上、小サイズ）
- 「持ってきたプレゼントについて教えてください」
- 「*マークの項目は必須です」（赤文字）
- **タイトル**（必須）: 最大20文字、文字数カウント表示
- **選んだポイント**（任意）: 最大50文字、テキストエリア、文字数カウント表示
- **おすすめの使い方など**（任意）: 最大50文字、テキストエリア、文字数カウント表示
- 「決定」ボタン（画面下部固定、タイトル入力時のみ有効化）

### 画面5: 参加者待機画面（ParticipantWaitingScreen）
- ロゴ（左上、小サイズ）
- 「MCがスタートするまでお待ちください...」
- ローディングアニメーション（円形スピナー）

### 画面6: 開始アニメーション画面（SantaWaitingScreen）
- ロゴ（左上、小サイズ）
- 「ホ〜ッホッホ...」
- 「みんな楽しんでいるかの〜？」
- 「プレゼントを配るぞ〜」
- サンタGIFアニメーションエリア（縦長、4:5比率）

### 画面7: プレゼント配布アニメーション画面（PresentRevealScreen）
- ロゴ（左上、小サイズ）
- 「{参加者のニックネーム}！」
- 「君にはこのプレゼントをあげよう！」
- 「メリークリスマス！」
- プレゼントGIFアニメーションエリア（縦長、4:5比率）

### 画面8: プレゼント詳細画面（PresentDetailScreen）
- ロゴ（左上、小サイズ）
- 「{贈り主} ▶ {受け取り手}へ」
- イラストエリア（16:9比率）
- プレゼントのタイトル（複数行対応）
- **選んだポイント**:
  - 見出し
  - 本文（複数行）
- **おすすめの使い方など**:
  - 見出し
  - 本文（複数行）
- **MC専用**: 「次のプレゼント」ボタン（画面下部固定）
  - MCモードの時のみ表示
  - 参加者モードでは非表示

### 画面9: 終了アニメーション画面（EndingScreen）
- TBD（未実装）

### 画面10: 結果一覧画面（ResultListScreen）
- ロゴ（左上、小サイズ）
- 「みんなのプレゼント」（中央揃え、大きめ）
- プレゼントカードリスト:
  - イラスト（左側、正方形100px）
  - 「{贈り主} ▶ {受け取り手}へ」
  - プレゼントタイトル（2行まで表示）
  - 右矢印（›）
  - クリックで詳細モーダルを表示

### 画面11: 結果詳細モーダル（ResultDetailModal）
- グレー半透明オーバーレイ（背景）
- ロゴ（オーバーレイ層、左上）
- 白い角丸モーダルカード:
  - 「{贈り主} ▶ {受け取り手}へ」
  - イラスト（16:9比率）
  - プレゼントのタイトル
  - 選んだポイント（見出し + 本文）
  - おすすめの使い方など（見出し + 本文）
  - 「閉じる」ボタン

## 🛠 技術要件

### フロントエンド
- **フレームワーク**: Next.js 14+ (App Router)
- **言語**: TypeScript
- **スタイリング**: CSS Modules / Tailwind CSS
- **アニメーション**: Framer Motion / CSS Animations
- **画像処理**: html2canvas（画像生成用）
- **状態管理**: React Context API / Zustand

### バックエンド・データ管理
- **リアルタイム通信**: WebSocket / Server-Sent Events
- **データベース**: Firebase Realtime Database / Supabase
- **画像ストレージ**: Firebase Storage / Cloudinary

### 主要ライブラリ
- `react`: UIフレームワーク
- `next`: Next.jsフレームワーク
- `typescript`: 型安全性
- `framer-motion`: アニメーション
- `html2canvas`: 画像生成
- `react-dropzone`: 画像アップロード
- Firebase SDK / Supabase Client

### デプロイ
- **ホスティング**: Vercel / Netlify
- **環境変数管理**: .env.local

## 🎯 機能要件詳細

### FR-1: 参加者管理
- FR-1.1: 参加者は名前を入力できる
- FR-1.2: 1人のみMCとして指定できる
- FR-1.3: 参加者リストをリアルタイムで表示
- FR-1.4: 参加者の削除・編集が可能

### FR-2: プレゼント情報管理
- FR-2.1: プレゼントタイトルを必須入力
- FR-2.2: 選んだ理由を必須入力
- FR-2.3: 画像アップロード（任意、最大5MB）
- FR-2.4: おすすめの使い方入力（任意）
- FR-2.5: 入力状態を他の参加者に表示

### FR-3: プレゼント配布ロジック
- FR-3.1: 完全順列アルゴリズムで組み合わせ生成
- FR-3.2: 自分のプレゼントが自分に当たらないことを保証
- FR-3.3: ランダム性の確保

### FR-4: 交換演出
- FR-4.1: サンタアニメーションの表示
- FR-4.2: メッセージのアニメーション表示
- FR-4.3: プレゼント情報のフェードイン表示
- FR-4.4: MC専用の進行ボタン
- FR-4.5: 参加者には進行ボタンを非表示

### FR-5: 結果表示・共有
- FR-5.1: 結果を受け取り者順にリスト表示
- FR-5.2: 各プレゼント情報を画像化
- FR-5.3: 画像のダウンロード機能
- FR-5.4: SNS共有機能（Twitter, 画像保存）
- FR-5.5: シェアテキストのカスタマイズ

## 🔒 非機能要件

### NFR-1: パフォーマンス
- ページ読み込み時間: 3秒以内
- 画像生成時間: 5秒以内
- リアルタイム同期遅延: 1秒以内

### NFR-2: セキュリティ
- 画像アップロードのバリデーション（形式、サイズ）
- XSS対策（入力のサニタイズ）
- CSRF対策

### NFR-3: ユーザビリティ
- レスポンシブデザイン（スマホ・タブレット・PC対応）
- 直感的なUI/UX
- アクセシビリティ対応（WCAG 2.1 AA準拠）

### NFR-4: 互換性
- モダンブラウザ対応（Chrome, Firefox, Safari, Edge最新版）
- iOS Safari対応
- Android Chrome対応

### NFR-5: 可用性
- アップタイム: 99.9%
- エラー時のフォールバック表示
- オフライン対応（PWA化）

## 📊 データモデル

### User（参加者）
```typescript
interface User {
  id: string;
  name: string;
  isMC: boolean;
  hasCompletedInput: boolean;
  createdAt: Date;
}
```

### Gift（プレゼント）
```typescript
interface Gift {
  id: string;
  giverId: string; // User.id
  title: string;
  imageUrl?: string;
  reason: string;
  recommendation?: string;
  createdAt: Date;
}
```

### Exchange（交換結果）
```typescript
interface Exchange {
  id: string;
  eventId: string;
  giverId: string; // User.id
  receiverId: string; // User.id
  giftId: string; // Gift.id
  revealedAt?: Date;
}
```

### Event（イベント）
```typescript
interface Event {
  id: string;
  status: 'registration' | 'input' | 'exchange' | 'completed';
  currentExchangeIndex: number;
  createdAt: Date;
}
```

## 🚀 開発フェーズ

### Phase 1: MVP（最小実行可能製品）
- [ ] 参加者登録機能
- [ ] プレゼント情報入力機能
- [ ] 基本的な交換ロジック
- [ ] シンプルな交換演出
- [ ] 結果一覧表示

### Phase 2: 演出強化
- [ ] サンタアニメーション
- [ ] トランジションアニメーション
- [ ] 効果音・BGM

### Phase 3: 共有機能
- [ ] 画像生成機能
- [ ] SNSシェア機能
- [ ] 画像ダウンロード機能

### Phase 4: UX改善
- [ ] レスポンシブ対応
- [ ] PWA化
- [ ] パフォーマンス最適化
- [ ] アクセシビリティ改善

## 🎨 デザインガイドライン

### カラーパレット
- プライマリ: クリスマスレッド (#C41E3A)
- セカンダリ: クリスマスグリーン (#0F8B3A)
- アクセント: ゴールド (#FFD700)
- 背景: ホワイト (#FFFFFF)
- テキスト: ダークグレー (#333333)

### タイポグラフィ
- ヘッダー: 太字、大きめのサイズ
- 本文: 読みやすいサンセリフフォント
- 強調: ゴールドまたは赤色

### アニメーション
- イージング: ease-in-out
- デュレーション: 0.3s - 0.5s
- サンタアニメーション: 2-3秒

## 📝 将来的な拡張機能（Nice to Have）

1. **多言語対応**: 英語、中国語など
2. **テーマ切り替え**: クリスマス以外のテーマ（誕生日、バレンタインなど）
3. **プレゼント予算管理**: 予算の設定と表示
4. **匿名モード**: 贈り主を最後まで隠す
5. **動画メッセージ**: 音声・動画でメッセージを残せる
6. **投票機能**: ベストプレゼント賞など
7. **リマインダー**: イベント前の通知
8. **テンプレート**: プレゼント情報のテンプレート
9. **統計情報**: 過去のイベント履歴

## 📄 ライセンス

MIT License

## 👨‍💻 開発者向け情報

### セットアップ
```bash
# 依存関係のインストール
npm install

# 開発サーバー起動
npm run dev

# ビルド
npm run build

# 本番環境起動
npm start
```

### 環境変数
```env
NEXT_PUBLIC_API_URL=
NEXT_PUBLIC_FIREBASE_API_KEY=
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=
NEXT_PUBLIC_FIREBASE_PROJECT_ID=
```

---

**作成日**: 2025年12月17日
**バージョン**: 1.0.0

